# 02 | 该如何选择消息队列？

在消息队列的技术选型问题上，并不存在说，哪个消息队列就是“最好的”。常用的这个几个消息队列，每一个产品都有自己的优劣势，你需要根据现有系统的情况，选择适合的产品。

### 选择消息队列产品的基本标准

- **必须时开源的 ，这个非常重要 **。 开源意味着，如果有一天你使用的消息队列遇到了一个影响你系统业务的 Bug，你至少还有机会通过修改源代码来迅速修复或规避这个 Bug，解决你的系统火烧眉毛的问题，而不是束手无策地等待开发者不一定什么时候发布的下一个版本来解决。（最惨自己还可修改代码）
- **这个产品必须时近几年流行并且有一定的社区活跃度的产品**。
  - **流行的好处是，只要你的使用场景不太冷门，你遇到 Bug 的概率会非常低**，因为大部分你可能遇到的 Bug，其他人早就遇到并且修复了。你在使用过程中遇到的一些问题，也比较容易在网上搜索到类似的问题，然后很快的找到解决方案。 (可以谷歌查找答案)
  - **流行的产品与周边生态系统会有一个比较好的集成和兼容**，比如，Kafka 和 Flink 就有比较好的兼容性，Flink 内置了 Kafka 的 Data Source，使用 Kafka 就很容易作为 Flink 的数据源开发流计算应用，如果你用一个比较小众的消息队列产品，在进行流计算的时候，你就不得不自己开发一个 Flink 的 Data Source。(兼容性好)
- **合格的消息队列**（必须含有一下特性）
  - 消息的可靠传统：确保不会丢失数据；
  - Cluster：支持集群，确保不因为某个节点宕机导致服务不可用，当然也不可以丢失数据；
  - 性能：具备足够好的性能，能满足大多数的性能要求。

### 可供选择的消息队列产品

#### 1. RabbitMQ

**优点：**

- **轻量级、迅捷， 开箱即用的消息队列**, 非常容易部署和使用。 
- **支持非常灵活的流量配置**。在生产者（Producer）和队列（Queue）之间增加了一个 Exchange 模块，你可以理解为交换机。
-   RabbitMQ 的客户端支持的编程语言大概是所有消息队列中最多的。

**缺点**

- **Erlang 语言编写的**，Erlang 学曲线较陡，如果有问题不方便该源代码，建议你慎重考虑一下可持续维护的问题 
- **RabbitMQ 对消息堆积的支持并不好** 。在它的设计理念里面，消息队列是一个管道，大量的消息积压是一种不正常的情况，应当尽量去避免。当大量消息积压的时候，会导致 RabbitMQ 的性能急剧下降。
- **介绍的这几个消息队列中最差的 **。 它大概每秒钟可以处理几万到十几万条消息，但能应付大多数应用场景。

#### 2. RocketMQ

**优点：**

-  **响应时延低**。大多数情况下可以做到毫秒级的响应，如果你的**应用场景很在意响应时延，那应该选择使用 RocketMQ**。

- **有着不错的性能，稳定性和可靠性** 。 具备一个现代的消息队列应该有的几乎全部功能和特性，并且它还在持续的成长中。 
- **RocketMQ 有非常活跃的中文社区** 。 大多数问题你都可以找到中文的答案，也许会成为你选择它的一个原因 。
- **RocketMQ 使用 Java 语言开发**。它的贡献者大多数都是中国人，源代码相对也比较容易读懂，你很容易对 RocketMQ 进行扩展或者二次开发。 

**缺点：**

- **在国际上还没有那么流行**。作为国产的消息队列，相比国外的比较流行的同类产品，在国际上还没有那么流行，与周边生态系统的集成和兼容程度要略逊一筹 

#### 3.Kafka

**优点:**

- **Kafka 与周边生态系统的兼容性是最好的没有之一** 。 尤其在大数据和流计算领域，几乎所有的相关开源软件系统都会优先支持 Kafka。
- **超高的性能** 。 Kafka 使用 Scala 和 Java 语言开发，设计上大量使用了批量和异步的思想，这种设计使得 Kafka 能做到超高的性能。Kafka 的性能，尤其是异步收发的性能，是三者中最好的，但与 RocketMQ 并没有量级上的差异，大约每秒钟可以处理几十万条消息。 

**缺点:**

- **同步收发消息的响应时延比较高**。 异步批量的设计带来的缺点,它的同步收发消息的响应时延比较高，因为当客户端发送一条消息的时候，Kafka 并不会立即发送出去，而是要等一会儿攒一批再发送  所以，**Kafka 不太适合在线业务场景** 

### 第二梯队的消息队列

面给你介绍的三大消息队列之外，还有几个第二梯队的产品，我个人的观点是，这些产品之所以没那么流行，**或多或少都有着比较明显的短板**，**不推荐使用**。在这儿呢，我简单介绍一下，纯当丰富你的知识广度。 

-  **ActiveMQ** 

  - 最老牌的开源消息队列, 十年前唯一可供选择的开源消息队列;
  - 社区不活跃;
  - 性能方面差;
  - 现在存在的意义就是兼容爷爷辈的系统。
-  **ZeroMQ** 
  -  ZeroMQ 并不能称之为一个消息队列 
  -  是一个基于消息队列的多线程网络库, 如果你的需求是将消息队列的功能集成到你的系统进程中，可以考虑使用 ZeroMQ。 
-   **Pulsar** 
   -   一个新兴的开源消息队列产品 ;
   -  目前处于成长期，流行度和成熟度相对没有那么高 
   -  Pulsar 采用存储和计算分离的设计 
   -  可以持续关注该项目

### 小结

- **RabbitMQ**：如果，消息队列不是你构建系统的主角之一，你**对消息队列功能和性能都没有很高的要求**，只需要一个开箱即用易于维护的产品，我建议你使用 RabbitMQ。 
-  **RocketMQ**: 如果,你的系统使用**消息队列主要场景是处理在线业务**，比如在交易系统中用消息队列传递订单，那 RocketMQ 的低延迟和金融级的稳定性是你需要的。
- **Kafka**:如果,**你需要处理海量的消息**，像收集日志、监控信息或是前端的埋点这类数据，或是你的应用场景大量使用了大数据、流计算相关的开源产品，那 Kafka 是最适合你的消息队列。 
- **选你熟悉的**：如果这些场景都不符合，那就选你熟悉的，毕竟这些产品都能满足大多数应用场景，使用熟悉的产品还可以快速上手不是？ 