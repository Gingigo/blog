## 06、域名

- IP 地址把 MAC 编号转换成了四位数字，这就对物理网卡的 MAC 地址做了一层抽象；

- DNS 域名系统是在 IP 地址之上再来一次抽象，把数字形式的 IP 地址转换成更有意义更好记的名字；

### 域名的形式

- 域名是一个有层次的结构，是一串用“ . ” 分隔的多个单词；
- 最右边是“顶级域名”,然后是“ 二级域名 ”, 最左边的是主机名。主机名通常用来表明主机的用途。
- 域名本质上是个命名空间系统，每个域名都是独一无二的，可以作为唯一的身份表示。

> 如： `time.geekbang.org` 
>
> - “org”就是顶级域名
> -  “geekbang”是二级域名 
> -  time”则是主机名 



### 域名解析

就像 IP 地址必须转成 MAC 地址才能访问主机一样，域名也必须转成 IP 地址，这个过程就是 **“域名解析”**。

![](https://raw.githubusercontent.com/dddygin/image-storage/main/blog/image/network/http/01/06_01.png)

<center>图 01 DNS服务器结构</center>

DNS 的核心系统是一个三层树状、分布式服务、基本对应域名的结构：

1. 根域名服务器（Root DNS Server):管理顶级域名服务器，返回 ”com“、”net"、“cn” 等顶级域名服务的 IP 地址；
2. 顶级域名服务器（Top-level DNS Server）: 管理各自域名下的权威域名服务器，比如 com 顶级域名服务器可以返回 apple.com 域名服务器的地址；
3. 权威域名服务器（ Authoritative DNS Server）:管理自己域名下的主机 IP 地址，比如 apple.com 权威域名服务器可以返回 www.apple.com 的 IP 地址。

>  根域名服务器是关键，它必须是众所周知的，否则下面的各级服务器就无从谈起了。目前全世界共有 13 组根域名服务器，又有数百台的镜像，保证一定能够被访问到。 

>  例如，你要访问“www.apple.com”，就要进行下面的三次查询： 
>
> 1. 访问根域名服务器，它会告诉你“com”顶级域名服务器的地址；
> 2. 访问“com”顶级域名服务器，它再告诉你“apple.com”域名服务器的地址；
> 3. 最后访问“apple.com”域名服务器，就得到了“www.apple.com”的地址。



 **减轻域名解析的压力** ：

1.  **缓存** ： 许多大公司、网络运行商都会建立自己的 DNS 服务器，作为用户 DNS 查询的代理，代替用户访问核心 DNS 系统 。这些DNS 系统可以缓存之前的查询结果，如果已经有了记录，就无需再向根服务器发起查询，直接返回对应的 IP 地址。 
2. **主机映射**： hosts  文件配置映射。

### 运用

- 便利性，对 IP 地址进行抽象，方便记忆；
  - www.apple.com 比 “27.148.139.136” 更加容易记住 。

-  重定向 ， 因为域名代替了 IP 地址，所以可以让对外服务的域名不变，而主机的 IP 地址任意变动 ;
  - 当主机有情况需要下线、迁移时，可以更改 DNS 记录，让域名指向其他的机器。 
-  负载均衡 
  -  第一种方式，因为域名解析可以返回多个 IP 地址，所以一个域名可以对应多台主机，客户端收到多个 IP 地址后，就可以自己使用轮询算法依次向服务器发起请求，实现负载均衡。
  -  第二种方式，域名解析可以配置内部的策略，返回离客户端最近的主机，或者返回当前服务质量最好的主机，这样在 DNS 端把请求分发到不同的服务器，实现负载均衡。 

#### 恶意DNS

- “ 域名屏蔽 ” 对域名直接不解析，返回错误，让你无法拿到 IP 地址，也就无法访问网站； 
-  域名劫持”，也叫“域名污染”，你要访问 A 网站，但 DNS 给了你 B 网站。 

### 其他

- DNS 是一个树状的分布式查询系统，但为了提高查询效率，外围有多级的缓存；
- 域名最早支持英文，现在已经放开了，中文也可以；
- 域名总长度现在在 254 个字符内，而每一级域名长度不能超过 63 个字符；
- 域名是大小写无关，通常是小写；
- 域名层级不易过长，多是二级和三级，四级以上很少见。